<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Alibaba Cloud on Goldstine研究所</title>
    <link>https://blog.mosuke.tech/categories/alibaba-cloud/</link>
    <description>Recent content in Alibaba Cloud on Goldstine研究所</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>ja</language>
    <lastBuildDate>Wed, 04 Jan 2017 22:35:00 +0900</lastBuildDate>
    
	<atom:link href="https://blog.mosuke.tech/categories/alibaba-cloud/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>クラウド上でのWordPressのスケールアウトを考える</title>
      <link>https://blog.mosuke.tech/entry/2017/01/04/223544/</link>
      <pubDate>Wed, 04 Jan 2017 22:35:00 +0900</pubDate>
      
      <guid>https://blog.mosuke.tech/entry/2017/01/04/223544/</guid>
      <description>複数台サーバでのWordPressの構築・運用について考える。
実際に、とあるクラウドで分散環境のWordPressを構築したのでその知見をまとめる。
なるべく特定のクラウドに特価しないものとして記載したい。
やりたいこと  スケールアウトできるWordPress環境を作る  SSLに対応する HTTP/2に対応する  AWSなどのクラウド環境で構築する  アーキテクチャ まず先に全体のアーキテクチャ図から示す。
これから各項目について解説していく。

 SSL・HTTP/2への対応 まずSSLへの対応だが、通常ならばロードバランサをSSLの終端とし下記のような構成にすることが多いだろう。
この場合はロードバランサをL7のものとして稼働させる。

しかし、HTTP/2に対応しようと思うと事情は異なってくる。
（もちろん、最近ではAWSのALBのようにHTTP/2に対応する製品がでてきているのは承知だが。）
現在のパブリッククラウドで利用できるロードバランサの多くはまだHTTP/2に対応していない。
そのため、ロードバランサをL4として稼働させ、配下のWebサーバにてHTTP/2を処理する必要がでてくる。
この場合、ロードバランサはTCPでポート443を待ち受けるようにし、配下のWebサーバへポート443のままでフォワードすればいい。

クラウド環境ではWebサーバがスケールすることは前提にいれることがおおい。
そのため、この場合のSSL証明書はN台に対応した製品を買う必要がある。
例えば以下のような製品など。
 SureServer for クラウド｜Cybertrust.ne.jp  データベースの分離 分散環境でのWordpressでは共通したコンテンツを配信するため、データベースはもちろんWebサーバとは分離したほうがいい。
それぞれのWebサーバは共通のデータベースを見に行くべきだ。
データベースを自前で冗長化しても構わないが、それなりの運用コストがかかることは容易に想像がつくので、
クラウドのマネージドデータベースサービスを利用した。
 Amazon RDS（クラウドでのリレーショナルデータベースサービス） | AWS ApsaraDB for RDS - データベースホスティング | Alibaba Cloud  管理画面 管理画面のみを分離するアーキテクチャも考えられるが、ここではそうしないこととする。
管理画面へのログインセッションの保持は、別途KVS(RedisやMemcached)に保存してもいいと思う。
ですが、WordPress4.0以降ではデフォルトではMySQLへセッションを保存するので必須の対応ではないといえる。
github.com
記事で使うアップロード画像などの対応 管理画面から記事を投稿するとする。
記事のデータはデータベースに保存されるためどのWebサーバからも記事を参照できる。
しかし、記事に含まれる画像データはどうだろうか。
通常のWordpressでは管理画面サーバの/wp-content/uploads以下に画像を保存する。
複数台Webサーバがある状態で、たまたまアクセスしているサーバに画像を保存しても、他のサーバからは参照することができない。
これに対するソリューションはいくつかあるだろう。
例えば、rsyncなどを使って他のサーバと画像ファイルを同期するとか、画像用のストレージを用意しNFSで参照するとか。
冗長化の観点からもここはオブジェクトストレージのサービスを利用するのがいいだろう。
例えば、下記のような製品だ。</description>
    </item>
    
    <item>
      <title>「嵐」 2016年振り返り</title>
      <link>https://blog.mosuke.tech/entry/2016/12/25/142744/</link>
      <pubDate>Sun, 25 Dec 2016 14:27:00 +0900</pubDate>
      
      <guid>https://blog.mosuke.tech/entry/2016/12/25/142744/</guid>
      <description>だいぶお久しぶりのブログ。 そして恒例の年振り返りブログ。ついに2016年も終わってしまう。
というわけで2016年を振り返りたいと思う。
一応このサイトは技術ブログのはずなんだけど、プライベートのことが大いに混ざったポエムになってしまった。
なんの変哲もないはじまり 2016年のはじめのほう。振り返ってもとくに振り返ることがあまりないくらい変哲もない日々だった。
嵐の前の静けさだったと今思う。
TDD研修、プロマネ研修 後述するが8月までは、社内システムのエンジニアとして活動していた。
いつもどおり、内製開発のチームをどう強くするかばかり考え働いていた。
そんななか、新しい開発チームの模索のために部署を代表としてTDD（テスト駆動開発）の研修や、
プロジェクトマネージャーの研修など受けさせてもらった。
そのなかでもTDD研修はとても印象深い。
なぜなら、私が気に入っていた「Rubyによるデザインパターン」の翻訳者の一人が講師だったからだ。
さらには、研修の受講生は2人しかおらず、徹底してTDDを実践できた。
こんな恵まれた外部研修があるもんかと、感心したのを思い出す。

Rubyによるデザインパターン
  作者: Russ Olsen,ラス・オルセン,小林健一,菅野裕,吉野雅人,山岸夢人,小島努  出版社/メーカー: ピアソン桐原  発売日: 2009/04/01  メディア: 単行本  購入: 13人 クリック: 220回 この商品を含むブログ (67件) を見る     Gem公開、ATP-stat開発 会社のとあるプロジェクトでRails使うことになり、
趣味がてらにRailsを使ってATP-statというサービスを開発していた。
正直、ほんとに趣味で作ったものでクオリティは全く高くないし、最近はメンテもできていない。
AtpStat
また、このサービスに利用する仕組みをAtpScraperというGemにして公開した。
これは、せっかく受けたTDD研修を活かして、テスト駆動開発で行ったりしていた。
github.com
嵐 と、まあさほどいままでと変わらない感じの日々を送っていた。
だが、6月くらいから嵐が吹き始める。
プライベートでかなりショッキングなことがあった。ショッキングであると同時に生活がだいぶ変わるようなこと。 それだけでもショッキングではあるのだけれど、その出来事はなにかのトリガーを引いてしまったようだ。
世界線が変動したのかもしれない。
異動 まず、ショッキングな出来事からわずか1週間後に、社内転職の結果がでた。
詳しくは下記のブログを読んでほしいが、パブリッククラウドを提供する新規事業を行う会社に行くことになったのだ。
社内システム開発からパブリッククラウドの会社へジョインします - Goldstine研究所
仕事環境の変化 仕事の環境は劇的に変わった。正直何もかもが違うといっても過言ではない。
変わった項目をまとめてみた。
   項目 前の仕事 今の仕事     システム種別 ネットワーク監視システム パブリッククラウド   職種 システムエンジニア セールスエンジニア？   組織規模 大組織の中の１部署で100人程度 会社全体で数十人   チーム エンジニアのみ エンジニア、営業、マーケティングなど   お客様 社内 社外   人 ほぼ100%日本人 半分くらい外国人   英語 利用しない 飛び交ってる    実際の仕事 セールスエンジニア 最初に断っておくが、今の職種をセールスエンジニアというと少し語弊はあるのだが、</description>
    </item>
    
  </channel>
</rss>