<!DOCTYPE html>
<html lang="ja">
    <head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">


<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<link rel="stylesheet" href="/css/main.css">

<title>CentOS7でのiptables設定方法について</title>
<link rel="canonical" href="https://blog.mosuke.tech/entry/2014/09/20/180326/">
<link rel="alternate" hreflang="ja" href="https://blog.mosuke.tech/entry/2014/09/20/180326/" />
<meta name="twitter:card" content="summary">

<meta name="twitter:site" content="@mosuke5" />
<meta name="twitter:creator" content="@mosuke5" />

<meta name="twitter:title" content="CentOS7でのiptables設定方法について &middot; Goldstine研究所">
<meta name="twitter:description" content=" 最近VPSのOSをcentos7にしたのだが、なかなか手付かずでiptablesの設定も放置していた… （sshの最低限の設定はしていたが、ほんとうに良くない…）  久しぶりに手が空いたので設定するかーと思いきや まず/etc/sysco">
<meta property="og:type" content="article">
<meta property="og:title" content="CentOS7でのiptables設定方法について &middot; Goldstine研究所">
<meta property="og:description" content=" 最近VPSのOSをcentos7にしたのだが、なかなか手付かずでiptablesの設定も放置していた… （sshの最低限の設定はしていたが、ほんとうに良くない…）  久しぶりに手が空いたので設定するかーと思いきや まず/etc/sysco">
<meta property="og:image" content="https://blog.mosuke.tech/image/goldstine-lab-logo.png" />
<meta property="og:site_name" content="Goldstine研究所" />
<meta property="og:url" content="https://blog.mosuke.tech/entry/2014/09/20/180326/" />
<link rel="alternate" type="application/rss+xml" title="Goldstine研究所" href="https://blog.mosuke.tech/index.xml" />
<link rel="icon" href="/image/favicon.ico" />


<meta name="msvalidate.01" content="9220008783970B337CA4AE8362168354" />
</head>
    <body><header>
  <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
    <a class="navbar-brand" href="/">Goldstine研究所</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarCollapse">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item">
          <a class="nav-link" href="/">Home <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/about">About</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/entry">Blog</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Kubernetes (Coming soon)</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://docs.google.com/forms/d/e/1FAIpQLSd6N53H7zfF8EBrvyezRizU1mQx-CP3vc_jG-WvxfRmCjHTpg/viewform" target="_blank" onClick="ga('send','event','link','click','contact');">Contact</a>
        </li>
      </ul>
    </div>
  </nav>
</header><main id="content" role="main">
            <div class="container">
                <div class="row">
<div class="entry col-md-8 col-xs-12">
    <h1>CentOS7でのiptables設定方法について</h1>
    <div class="entry-sub-title">
        <span class="">20 Sep 2014, 18:03</span>
        <span class="">By mosuke5</span>
        
            
                <a class="badge badge-inf post-category post-category-インフラ構築" href="/categories/%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%89">インフラ構築</a>
            
        
    </div>
    <div class="entry-content">
        <p>最近<a class="keyword" href="http://d.hatena.ne.jp/keyword/VPS">VPS</a>のOSをcentos7にしたのだが、なかなか手付かずで<a class="keyword" href="http://d.hatena.ne.jp/keyword/iptables">iptables</a>の設定も放置していた。<br>
（<a class="keyword" href="http://d.hatena.ne.jp/keyword/ssh">ssh</a>の最低限の設定はしていたが、ほんとうに良くない。みなさんはこういうことがないように。）</p>
<p>久しぶりに手が空いたので設定しようとするが、<br>
まず`/etc/sysconfig/iptables`がない。</p>
<p>Cent7からのsystemctlで<a class="keyword" href="http://d.hatena.ne.jp/keyword/iptables">iptables</a>のサービスを確認してもでてこない。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback"># systemctl status iptables
iptables.service
   Loaded: not-found (Reason: No such file or directory)
   Active: inactive (dead)
</code></pre></div><p>というわけで、調べてみると、そもそもCentOS7からはfirewalldが標準になっており、iptablesは入っていない。なので、iptables.serviceをインスールしないといけないとのこと。<br>
そして、firewalldがデフォルトでオンになっているからオフにしないといけない。<br>
（いけないわけではないけど両方使う意味が無いので。）</p>
<p>本当は、firewalldの設定方法を覚えなければいけないが、今までのやり方をそのままやりたいひとむけにCentOS7でのiptablesの設定方法を残す。</p>
<p>まずは<a class="keyword" href="http://d.hatena.ne.jp/keyword/iptables">iptables</a>-serviceをインスールし、firewalldをオフ、<a class="keyword" href="http://d.hatena.ne.jp/keyword/iptables">iptables</a>をオンとした。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback"># yum install iptables-services
# systemctl status firewalld
   Loaded: loaded (/usr/lib/systemd/system/firewalld.service; enabled)
   Active: active (running) since Sat 2014-09-20 17:47:11 JST; 4s ago
 Main PID: 11162 (firewalld)
   CGroup: /system.slice/firewalld.service
           └─11162 /usr/bin/python -Es /usr/sbin/firewalld --nofork --nopid

#
# systemctl stop firewalld
#
# systemctl status firewalld
   Loaded: loaded (/usr/lib/systemd/system/firewalld.service; enabled)
   Active: inactive (dead)

#
#systemctl disable firewalld
#
#systemctl enable iptables
#systemctl start iptables
#
#systemctl status iptables
   Loaded: loaded (/usr/lib/systemd/system/iptables.service; enabled)
   Active: inactive (dead) since Sat 2014-09-20 17:47:10 JST; 2min 48s ago
  Process: 11139 ExecStop=/usr/libexec/iptables/iptables.init stop (code=exited, status=0/SUCCESS)
  Process: 10096 ExecStart=/usr/libexec/iptables/iptables.init start (code=exited, status=0/SUCCESS)
 Main PID: 10096 (code=exited, status=0/SUCCESS)
....

# 
</code></pre></div><p><a class="keyword" href="http://d.hatena.ne.jp/keyword/iptables">iptables</a>の設定はいつもどおり。<br>
CentOS7の新しいコマンドに戸惑ったので一部メモ。</p>
<h2>service, chkconfigコマンドはsystemctlコマンドへ</h2>
service, chkconfigコマンドは推奨されずsystemctlコマンドへ切り替わった。<br>
試しにchkconfigコマンドを利用すると…
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback"># chkconfig --list
Note: This output shows SysV services only and does not include native
      systemd services. SysV configuration data might be overridden by native
      systemd configuration.

      If you want to list systemd services use &#39;systemctl list-unit-files&#39;.
      To see services enabled on particular target use
      &#39;systemctl list-dependencies [target]&#39;.

iprdump        	0:off	1:off	2:on	3:on	4:on	5:on	6:off
iprinit        	0:off	1:off	2:on	3:on	4:on	5:on	6:off
iprupdate      	0:off	1:off	2:on	3:on	4:on	5:on	6:off
netconsole     	0:off	1:off	2:off	3:off	4:off	5:off	6:off
network        	0:off	1:off	2:on	3:on	4:on	5:on	6:off
pmcd           	0:off	1:off	2:off	3:off	4:off	5:off	6:off
pmie           	0:off	1:off	2:off	3:off	4:off	5:off	6:off
pmlogger       	0:off	1:off	2:off	3:off	4:off	5:off	6:off
pmmgr          	0:off	1:off	2:off	3:off	4:off	5:off	6:off
pmproxy        	0:off	1:off	2:off	3:off	4:off	5:off	6:off
pmwebd         	0:off	1:off	2:off	3:off	4:off	5:off	6:off
</code></pre></div><blockquote>
    <p>"If you want to list systemd services use 'systemctl list-unit-files'."</p>
</blockquote>
<p>systemdのサービスを表示したければ、systemctl list-unit-filesを利用せよとのこと。<br>
試しに打つと以下のように表示される</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback"># systemctl list-unit-files
UNIT FILE                                   STATE
proc-sys-fs-binfmt_misc.automount           static
dev-hugepages.mount                         static
dev-mqueue.mount                            static
proc-fs-nfsd.mount                          static
proc-sys-fs-binfmt_misc.mount               static
sys-fs-fuse-connections.mount               static
sys-kernel-config.mount                     static
sys-kernel-debug.mount                      static
tmp.mount                                   disabled
var-lib-nfs-rpc_pipefs.mount                static
brandbot.path                               disabled
....
 
</code></pre></div><p>また、サービスの起動・停止・状態確認などは</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback"># service &lt;service name&gt; &lt;start/stop/restart/status&gt;
　↓
# systemctl &lt;start/stop/restart/status&gt; &lt;service name&gt;
</code></pre></div><p>そして、サービスの起動オプションの設定は</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback"># chkconfig &lt;service name&gt; &lt;on/off&gt;
   ↓
# systemctl &lt;enable/disable&gt; &lt;service name&gt;
</code></pre></div><p>慣れてしまえば、CentOS７の新しいコマンド体系、systemdも怖くないです。<br>
これからのことを考えて、いちはやく覚えてしまいましょう。</p>
    </div>
    <div class="entry-sub-content request-for-entry">
        <h5>フィードバック・相談(β)</h5>
        <p>本記事に対して、執筆者にフィードバックや聞きたいことがあればこちらのフォームからご記入ください。<a href="https://docs.google.com/forms/d/e/1FAIpQLSfvDsTxSsz2xRodgkYSXP8l-bpS39LIOoKrZwja8W_YWJRA7A/viewform?entry.853982869=CentOS7%e3%81%a7%e3%81%aeiptables%e8%a8%ad%e5%ae%9a%e6%96%b9%e6%b3%95%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6" target="_blank" onClick="ga('send','event','link','click','request-for-entry');">執筆者に問い合わせてみる</a></p>
    </div>
    <div class="entry-sub-content post-share">
        <div class="post-share-links">
            <a href="https://b.hatena.ne.jp/entry/" class="hatena-bookmark-button" data-hatena-bookmark-layout="basic-label-counter" data-hatena-bookmark-lang="ja" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/v4/public/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
            <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-show-count="false">Tweet</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
            <iframe src="https://www.facebook.com/plugins/share_button.php?href=https%3a%2f%2fblog.mosuke.tech%2fentry%2f2020%2f07%2f09%2fcontainer-image-size%2f&layout=button_count&size=small&mobile_iframe=true&appId=1383467145023614&width=90&height=20" width="90" height="20" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowTransparency="true"></iframe>
        </div>
    </div>
    <div class="entry-sub-content google-ads">
        <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-2753210161325997"
         data-ad-slot="3079733606"
         data-ad-format="auto"
         data-full-width-responsive="true"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>
    <div class="entry-sub-content disqus">
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "mosuke5-techblog" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
</div><div class="col-md-4 col-xs-12">
  <div class="sidebar-content related-post">
    <h3>最近の記事</h3>
    <ul class="list-group">
      
      <li class="list-group-item"><a href="https://blog.mosuke.tech/entry/2020/07/09/container-image-size/" onClick="ga('send','event','link','click','latest-posts');">コンテナイメージを軽くする方法と、その原理原則を考える</a></li>
      
      <li class="list-group-item"><a href="https://blog.mosuke.tech/entry/2020/07/08/container-image-security/" onClick="ga('send','event','link','click','latest-posts');">コンテナイメージの脆弱性のリスクと対策についてNIST SP 800-190に沿って考える</a></li>
      
      <li class="list-group-item"><a href="https://blog.mosuke.tech/entry/2020/07/05/customized-jenkins-on-openshift/" onClick="ga('send','event','link','click','latest-posts');">カスタマイズしたJenkinsを作成する方法 on OpenShift</a></li>
      
      <li class="list-group-item"><a href="https://blog.mosuke.tech/entry/2020/07/01/istio-sockshop/" onClick="ga('send','event','link','click','latest-posts');">Sock Shopを使ったサービスメッシュ体験のハンズオン</a></li>
      
      <li class="list-group-item"><a href="https://blog.mosuke.tech/entry/2020/05/10/tekton-operator/" onClick="ga('send','event','link','click','latest-posts');">TektonのOperatorによるインストールとHello World</a></li>
      
    </ul>
  </div>
  <div class="sidebar-content related-post">
    <h3>カテゴリー</h3>
    <ul class="list-group">
      
      <li class="list-group-item">
        <a href="/categories/alibaba-cloud" onClick="ga('send','event','link','click','categories');">alibaba-cloud (9)</a>
      </li>
      
      <li class="list-group-item">
        <a href="/categories/aws" onClick="ga('send','event','link','click','categories');">aws (14)</a>
      </li>
      
      <li class="list-group-item">
        <a href="/categories/devops" onClick="ga('send','event','link','click','categories');">devops (28)</a>
      </li>
      
      <li class="list-group-item">
        <a href="/categories/kubernetes" onClick="ga('send','event','link','click','categories');">kubernetes (19)</a>
      </li>
      
      <li class="list-group-item">
        <a href="/categories/%e3%82%a2%e3%83%97%e3%83%aa%e3%82%b1%e3%83%bc%e3%82%b7%e3%83%a7%e3%83%b3%e9%96%8b%e7%99%ba" onClick="ga('send','event','link','click','categories');">アプリケーション開発 (20)</a>
      </li>
      
      <li class="list-group-item">
        <a href="/categories/%e3%82%a4%e3%83%99%e3%83%b3%e3%83%88" onClick="ga('send','event','link','click','categories');">イベント (8)</a>
      </li>
      
      <li class="list-group-item">
        <a href="/categories/%e3%82%a4%e3%83%b3%e3%83%95%e3%83%a9%e6%a7%8b%e7%af%89" onClick="ga('send','event','link','click','categories');">インフラ構築 (25)</a>
      </li>
      
      <li class="list-group-item">
        <a href="/categories/%e3%82%ad%e3%83%a3%e3%83%aa%e3%82%a2" onClick="ga('send','event','link','click','categories');">キャリア (12)</a>
      </li>
      
      <li class="list-group-item">
        <a href="/categories/%e3%82%af%e3%83%a9%e3%82%a6%e3%83%89%e6%8a%80%e8%a1%93" onClick="ga('send','event','link','click','categories');">クラウド技術 (19)</a>
      </li>
      
      <li class="list-group-item">
        <a href="/categories/%e3%82%b3%e3%83%b3%e3%83%86%e3%83%8a" onClick="ga('send','event','link','click','categories');">コンテナ (7)</a>
      </li>
      
      <li class="list-group-item">
        <a href="/categories/%e3%83%96%e3%83%ad%e3%82%b0%e9%81%8b%e7%94%a8" onClick="ga('send','event','link','click','categories');">ブログ運用 (8)</a>
      </li>
      
      <li class="list-group-item">
        <a href="/categories/%e8%8b%b1%e8%aa%9e" onClick="ga('send','event','link','click','categories');">英語 (1)</a>
      </li>
      
      <li class="list-group-item">
        <a href="/categories/%e8%b3%87%e6%a0%bc%e8%a9%a6%e9%a8%93" onClick="ga('send','event','link','click','categories');">資格試験 (7)</a>
      </li>
      
    </ul>
  </div>
  <div class="sidebar-content related-post">
    <h3>アーカイブ</h3>
    <ul class="list-group">
      
      <li class="list-group-item">
        <a href="/archive/2014" onClick="ga('send','event','link','click','archive');">2014年 Archive (14)</a>
      </li>
      
      <li class="list-group-item">
        <a href="/archive/2015" onClick="ga('send','event','link','click','archive');">2015年 Archive (19)</a>
      </li>
      
      <li class="list-group-item">
        <a href="/archive/2016" onClick="ga('send','event','link','click','archive');">2016年 Archive (12)</a>
      </li>
      
      <li class="list-group-item">
        <a href="/archive/2017" onClick="ga('send','event','link','click','archive');">2017年 Archive (19)</a>
      </li>
      
      <li class="list-group-item">
        <a href="/archive/2018" onClick="ga('send','event','link','click','archive');">2018年 Archive (17)</a>
      </li>
      
      <li class="list-group-item">
        <a href="/archive/2019" onClick="ga('send','event','link','click','archive');">2019年 Archive (20)</a>
      </li>
      
      <li class="list-group-item">
        <a href="/archive/2020" onClick="ga('send','event','link','click','archive');">2020年 Archive (15)</a>
      </li>
      
    </ul>
  </div>
  <div class="sidebar-content custom-search">
    <h3>サイト内検索</h3>
    <div class="gcse-search"></div>
  </div>

  <div class="fixed-contents position-sticky">
    
    
    <div class="sidebar-content related-post">
      <h3>関連する記事</h3>
      <ul class="list-group">
        
        <li class="list-group-item"><a href="https://blog.mosuke.tech/entry/2018/04/21/basic-mysql-on-docker/" onClick="ga('send','event','link','click','related-posts');">DockerでのMySQLのセットアップ方法とその仕組みを理解する</a> (2018/04/21)</li>
        
        <li class="list-group-item"><a href="https://blog.mosuke.tech/entry/2018/01/14/elasticsearch-api/" onClick="ga('send','event','link','click','related-posts');">[随時更新] ElasticSearchの基本APIのまとめ</a> (2018/01/14)</li>
        
        <li class="list-group-item"><a href="https://blog.mosuke.tech/entry/2017/08/13/elasticsearch_basic/" onClick="ga('send','event','link','click','related-posts');">ElasticSearch入門 インストールから検索、そしてKibanaまで</a> (2017/08/13)</li>
        
        <li class="list-group-item"><a href="https://blog.mosuke.tech/entry/2017/01/04/223544/" onClick="ga('send','event','link','click','related-posts');">クラウド上でのWordPressのスケールアウトを考える</a> (2017/01/04)</li>
        
      </ul>
    </div>
    

    
    <ins class="adsbygoogle"
    style="display:block"
    data-ad-client="ca-pub-2753210161325997"
    data-ad-slot="4759840302"
    data-ad-format="auto"
    data-full-width-responsive="true"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
    
  </div>
</div>
                </div>
            </div>
        </main><footer class="container">
  <p class="float-right"><a href="#" class="btn btn-secondary">Back to top</a></p>
  <p>&copy; 2020 <strong>mosuke5</strong> All rights reserved.<br />Powered by hugo</p>
</footer>
        
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    
    ga('create', 'UA-99596316-1', 'auto');
    ga('send', 'pageview');
    
</script>
 
        <script async src="https://cse.google.com/cse.js?cx=012458736543810277235:x4juxtghjhg"></script>

        
        
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-2753210161325997",
            enable_page_level_ads: true
          });
        </script>
        
    </body>
</html>
